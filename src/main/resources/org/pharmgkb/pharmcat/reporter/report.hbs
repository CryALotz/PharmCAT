<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <title>
    PharmCAT Report{{#if title}} [{{title}}]{{/if}}
  </title>

  {{> "header"}}

</head>

<body>

<!--[if lt IE 9]>
<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
<![endif]-->

<h1>PharmCAT Report</h1>

<table class="table-small">
  {{#if title}}<tr><th>Title</th><td>{{title}}</td></tr>{{/if}}
  <tr><th>Date created</th><td>{{generatedOn}}</td></tr>
  <tr><th>PharmCAT Version</th><td>{{pharmcatVersion}}</td></tr>
  <tr><th>CPIC Version</th><td>{{cpicVersion}}</td></tr>
</table>

<div class="alert alert-info">
  <em>Disclaimer:</em> PharmCAT is only able to generate recommendations based on the information provided to the
  software. The gene and variant information for all reported sections are interpreted directly from user-supplied data.
  The user recognizes they are using PharmCAT at their own risk. For a detailed disclaimer see
  <a href="#disclaimer">section IV</a>.
</div>

<section>
  <h2>Sections</h2>
  <ol type="I">
    <li><a href="#genotypes">Genotype Summary</a></li>
    <li><a href="#guidelines">CPIC Recommendations</a></li>
    <li><a href="#genes">Allele Matching Details</a></li>
    <li><a href="#disclaimer">Disclaimers</a></li>
  </ol>
</section>

<section id="genotypes">
  <h2>Genotype Summary</h2>

  <p>Genotypes called: {{calledGenes}} / {{totalGenes}} </p>

  <table>
    <thead>
    <tr>
      <th>Drugs</th>
      <th>Gene</th>
      <th>Genotype</th>
      <th>Allele Functionality</th>
      <th>Phenotype</th>
      <th>Missing Variant Input<sup><a href="#genotypes-star">*</a></sup></th>
    </tr>
    </thead>
    <tbody>
    {{#each genotypes}}
      {{#if reportable}}
      <tr>
        <td>{{#each drugs}}
          {{{drug this}}}
        {{/each}}</td>
        <td>
          <a href="#{{gene}}">{{gene}}</a>{{#if hasMessages}}<sup><a href="#genotypes-dagger">&dagger;</a></sup>{{/if}}
        </td>
        <td>
          <div style="display: flex;">
            <div>
              {{#each calls}}
                <div>{{this}}</div>
              {{/each}}
            </div>
            {{#if unphased}}<div style="margin-left: 0.2em;"><sup><a href="#genotypes-ddagger">&ddagger;</a></sup></div>{{/if}}
          </div>
        </td>
        <td>
          {{#each functions}}
            <div>{{this}}</div>
          {{/each}}
        </td>
        <td>
          {{#each phenotype}}
            <div>{{this}}</div>
          {{/each}}
        </td>
        <td>
          {{missingVariants}}
        </td>
      </tr>
      {{/if}}
    {{/each}}
    </tbody>
  </table>

  <div class="footnote" id="genotypes-star">
    <sup>*</sup> Indicates there are alleles not considered for the genotype calls due to missing variant information, please see Allele calls section. Alleles that could not be considered due to missing input might change the metabolizer phenotype and possible CPIC recommendation.
  </div>
  <div class="footnote" id="genotypes-dagger">
    <sup>&dagger;</sup> Check the allele call details for this gene for more details about this call.
  </div>
  <div class="footnote" id="genotypes-ddagger">
    <sup>&ddagger;</sup> PharmCAT reports the genotype(s) that receive the highest score during the matcher process. In case of unphased data, additional genotypes might be possible and cannot be ruled out.
  </div>
  <div class="footnote">
    For a full list of disclaimers and limitations see the <a href="#disclaimer">Disclaimer section</a>.
  </div>
</section>

<section id="guidelines">
  <h2>CPIC Recommendations</h2>

  {{#each guidelines}}
    <section class="guideline">
      <h3 id="{{id}}">{{drugs}}</h3>

      <section>
        {{#each geneCalls}}
          <div class="geneCall">
            <a href="#{{gene}}">{{gene}}: {{diplotypes}}</a>
            <span>{{functions}}</span>
            {{#if outsideCall}} (from Outside Call){{/if}}
          </div>
          {{#if showHighlights}}
            <div class="geneCall">{{#each highlightedVariants}}<div><a href="#{{gene}}">{{this}}</a></div>{{/each}}</div>
          {{/if}}
        {{/each}}
      </section>

      {{#if multiMatch}}
        <div class="alert alert-info"><strong>Note:</strong> More than one call was made for the applicable gene so multiple annotation groups could be shown</div>
      {{/if}}

      <section>
        {{#each messages}}
          <div class="alert alert-info">{{{this}}}</div>
        {{/each}}
      </section>

      {{#unless reportable}}
        <div class="alert alert-info">No genotypes matched for {{uncalledGenes}} so annotations cannot be shown.</div>
      {{/unless}}
      {{#if reportable}}
        {{#unless matched}}
          <div class="alert alert-warning">No CPIC recommendation for this allele combination.</div>
        {{/unless}}
      {{/if}}

      {{#if image}}
        <div class="image"><img src="{{image/url}}" alt="{{image/altText}}"/></div>
      {{/if}}

      {{#if matched}}
        {{#each groups}}
          <table>
            <thead>
            <tr><th>Type</th><th>Annotation</th></tr>
            </thead>
            <tbody>
            {{#each annotations}}
              <tr><td>{{term}}</td><td>{{{annotation}}}</td></tr>
            {{/each}}
            </tbody>
          </table>
        {{/each}}
      {{/if}}

      <section>
        {{#each footnotes}}
          <div class="footnote">{{this}}</div>
        {{/each}}
      </section>

      <section>
        <p>For more information see:</p>
        <ul>
          {{#each urls}}
            <li><a href="{{this}}">{{this}}</a></li>
          {{/each}}
        </ul>
        {{#if citations}}
          <p>Citations:</p>
          <ul>
            {{#each citations}}
              <li><a href="https://www.ncbi.nlm.nih.gov/pubmed/{{pmid}}">{{title}}</a> [PMID:{{pmid}}] <em>{{journal}}</em>. {{year}}.</li>
            {{/each}}
          </ul>
        {{/if}}
      </section>
    </section>
  {{/each}}
</section>

<section id="genes">
  <h2>Allele Matching Details</h2>

  <div>
  <ol>
  {{#each geneCalls}}
    <li><a href="#{{gene}}">{{gene}} allele match data</a></li>
  {{/each}}
  </ol>
  </div>

  {{#each geneCalls}}
    <section class="gene">
      <h3 id="{{gene}}">{{gene}} allele match data</h3>

      <h4>Genotype {{#if outsideCall}}reported{{/if}}{{#unless outsideCall}}matched{{/unless}}</h4>
      <ul>
        {{#each diplotypes}}
          <li>{{this}}</li>
        {{/each}}
      </ul>

      <p><strong>Phasing status:</strong> {{phaseStatus}}</p>

      {{#if unphased}}
        <p>PharmCAT reports the genotype(s) that receive the highest score during the matcher process. In case of unphased data, additional genotypes might be possible and cannot be ruled out.</p>
      {{/if}}

      {{#if hasUncalledHaps}}
        <h4>Alleles Not Considered</h4>
        <p>The following alleles are not considered due to {{totalMissingVariants}} missing positions of the total {{totalVariants}} positions: {{uncalledHaps}}</p>
        <p>Carriage of these alleles might result in a different phenotype and different guideline recommendations.</p>
      {{/if}}

      {{#if outsideCall}}
        <div class="alert alert-info">
          The call for {{gene}} comes from an outside data source which does not supply position-level detail. For specific
          disclaimers and limitations, see the original genotyping source.
        </div>
      {{/if}}

      {{#if variantsUnspecified}}
        <div class="alert alert-info">No variant data available.</div>
      {{/if}}

      {{#each messages}}
        <div class="alert alert-warning">{{{this}}}</div>
      {{/each}}

      {{#unless variantsUnspecified}}
        <h4>Calls at Positions</h4>
        <table>
          <thead>
          <tr>
            <th>Position in VCF</th>
            <th>RSID</th>
            <th>Call in VCF</th>
            <th>Reference</th>
            <th>Related Alleles</th>
            <th>Warnings</th>
          </tr>
          </thead>
          <tbody>
          {{#each variants}}
            <tr>
              <td id="{{chr}}_{{position}}">{{chr}}:{{position}}</td>
              <td id="{{dbSnpId}}">{{dbSnpId}}</td>
              {{#if missing}}
                <td class="missingVariant"><div class="callMessage">Missing</div></td>
              {{/if}}
              {{#unless missing}}
                {{{variantAlleles this}}}
              {{/unless}}
              <td>
                {{wildtypeAllele}}
              </td>
              <td>
                {{#each alleles}}{{this}} {{/each}}
              </td>
              <td>
                <ul class="warningList">
                {{#each warnings}}<li>{{this}}</li>{{/each}}
                </ul>
              </td>
            </tr>
          {{/each}}
          </tbody>
        </table>
      {{/unless}}

      {{#unless variantsOfInterestUnspecified}}
        <h4>Other Positions of Interest</h4>
        {{#each extra-position-notes}}
          <div class="alert alert-warning">{{{this}}}</div>
        {{/each}}
        <table>
          <thead>
          <tr>
            <th>Position in VCF</th>
            <th>RSID</th>
            <th>Call in VCF</th>
          </tr>
          </thead>
          <tbody>
          {{#each variantsOfInterest}}
            <tr>
              <td id="{{position}}">{{chr}}:{{position}}</td>
              <td id="{{dbSnpId}}">{{dbSnpId}}</td>
              {{#if missing}}
                <td class="missingVariant"><em>missing</em></td>
              {{/if}}
              {{#unless missing}}
                {{{variantAlleles this}}}
              {{/unless}}
            </tr>
          {{/each}}
          </tbody>
        </table>
      {{/unless}}
    </section>
  {{/each}}
</section>

{{> "disclaimers"}}

</body>
</html>
